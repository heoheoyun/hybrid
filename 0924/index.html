<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶€ì‚° ë„ì‹œì² ë„ ê°€ì´ë“œ ğŸš‡</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        :root {
            --bs-blue: #0d6efd;
            --bs-indigo: #6610f2;
            --bs-purple: #6f42c1;
            --bs-pink: #d63384;
            --bs-red: #dc3545;
            --bs-orange: #fd7e14;
            --bs-yellow: #ffc107;
            --bs-green: #198754;
            --bs-teal: #20c997;
            --bs-cyan: #0dcaf0;
            --bs-gray: #6c757d;
            --bs-gray-dark: #343a40;
            --line1-color: #E63333; /* 1í˜¸ì„  ìƒ‰ìƒ */
            --line2-color: #00B168; /* 2í˜¸ì„  ìƒ‰ìƒ */
            --line3-color: #FF8F00; /* 3í˜¸ì„  ìƒ‰ìƒ */
            --line4-color: #60469E; /* 4í˜¸ì„  ìƒ‰ìƒ */
            --light-rail-color: #00A3DA; /* ê²½ì „ì²  ìƒ‰ìƒ */
            --default-marker-color: #6c757d; /* ê¸°ë³¸ ë§ˆì»¤ ìƒ‰ìƒ */
        }
        body {
            font-family: 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background-color: #f0f4f7;
            color: #34495e;
        }
        .container {
            max-width: 1100px;
            margin-top: 2rem;
            margin-bottom: 2rem;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            padding: 2.5rem;
        }
        h1, h2 {
            font-weight: 700;
            color: #2c3e50;
        }
        h1 {
            font-size: 2.5rem;
        }
        h2 {
            font-size: 1.75rem;
            margin-bottom: 1.5rem;
        }
        #map {
            height: 500px;
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .route-result {
            margin-top: 1.5rem;
            background-color: #eaf2f8;
            border: 1px solid #d4e6f1;
            padding: 1.5rem;
            border-radius: 8px;
        }
        .form-select, .btn, .form-control {
            border-radius: 8px;
        }
        .btn-primary {
            background-color: #3498db;
            border-color: #3498db;
            font-weight: 600;
        }
        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }
        .chart-container {
            margin-top: 2rem;
        }
        /* ê¸°ì¡´ ë§ˆì»¤ ìŠ¤íƒ€ì¼ */
        .leaflet-marker-icon.line-marker {
            width: 12px !important;
            height: 12px !important;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-weight: bold;
            text-align: center;
        }
        /* í™˜ìŠ¹ì—­ ë§ˆì»¤ (íƒœê·¹ ë¬¸ì–‘) ìŠ¤íƒ€ì¼ */
        .leaflet-marker-icon.transfer-marker-taegeuk {
            width: 16px !important;
            height: 16px !important;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            background: linear-gradient(to right, #00A1E0 50%, #EF4459 50%); /* ì™¼ìª½ íŒŒë‘, ì˜¤ë¥¸ìª½ ë¹¨ê°• */
        }
        .result-content {
            font-size: 1.1rem;
        }
        .result-content strong {
            color: #2c3e50;
        }
        .result-content .text-primary {
            font-weight: 600;
        }
        .accordion-item .accordion-header .line-icon {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin-right: 10px;
        }
        .line-1-bg { background-color: var(--line1-color); }
        .line-2-bg { background-color: var(--line2-color); }
        .line-3-bg { background-color: var(--line3-color); }
        .line-4-bg { background-color: var(--line4-color); }
        .list-group-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .search-container {
            position: relative;
            margin-bottom: 0.5rem;
        }
        .search-container input {
            padding-right: 2.5rem;
        }
        .search-container .bi {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }
    </style>
</head>
<body>

<div class="container">
    <header class="text-center mb-5">
        <h1>ğŸš† ë¶€ì‚° ë„ì‹œì² ë„ ê°€ì´ë“œ</h1>
        <p class="lead text-muted">ì§€ë„ë¥¼ í†µí•´ ë¶€ì‚° ì§€í•˜ì²  ë…¸ì„ ê³¼ ì—­ ì •ë³´ë¥¼ í™•ì¸í•˜ê³ , í¸ë¦¬í•˜ê²Œ ê²½ë¡œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”.</p>
    </header>

    <div class="row mb-5">
        <div class="col-12">
            <h2>ì§€í•˜ì²  ë…¸ì„  ì§€ë„</h2>
            <div id="map"></div>
        </div>
    </div>
    
    <hr class="my-4">

    <div class="row">
        <div class="col-12">
            <h2>ê²½ë¡œ ê²€ìƒ‰</h2>
            <div class="row g-3 align-items-end mb-3">
                <div class="col-md-5">
                    <label for="startStationSearch" class="form-label">ì¶œë°œì—­</label>
                    <div class="search-container">
                        <input type="text" class="form-control" id="startStationSearch" placeholder="ì—­ëª… ê²€ìƒ‰">
                        <i class="bi bi-search"></i>
                    </div>
                    <select id="startStation" class="form-select"></select>
                </div>
                <div class="col-md-5">
                    <label for="endStationSearch" class="form-label">ë„ì°©ì—­</label>
                    <div class="search-container">
                        <input type="text" class="form-control" id="endStationSearch" placeholder="ì—­ëª… ê²€ìƒ‰">
                        <i class="bi bi-search"></i>
                    </div>
                    <select id="endStation" class="form-select"></select>
                </div>
                <div class="col-md-2 d-grid">
                    <button class="btn btn-primary" type="button" id="searchBtn">ğŸ” ê²€ìƒ‰</button>
                </div>
            </div>
            <div id="routeResult" class="route-result d-none">
                <h4 class="mb-3">ê²½ë¡œ ê²€ìƒ‰ ê²°ê³¼</h4>
                <div id="resultContent" class="result-content"></div>
            </div>
        </div>
    </div>
    
    <hr class="my-4">
    
    <div class="row mb-5">
        <div class="col-12">
            <h2>ë…¸ì„ ë³„ ì—­ ëª©ë¡</h2>
            <div class="accordion" id="stationListAccordion">
                </div>
        </div>
    </div>
    
    <hr class="my-4">

    <div class="row chart-container">
        <div class="col-12">
            <h2>ë…¸ì„ ë³„ ì—­ ê°œìˆ˜ í†µê³„</h2>
            <canvas id="stationChart"></canvas>
        </div>
    </div>

    <footer class="text-center mt-5 text-muted">
        <small>Powered by Leaflet.js, Chart.js, and Bootstrap | data.go.kr API</small>
    </footer>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
    // 1. ë¶€ì‚° ë„ì‹œì² ë„ ì „ì²´ ì—­ ì •ë³´ (ì œê³µëœ 'ì—­ ì½”ë“œëª©ë¡.xlsx - Sheet1.csv' íŒŒì¼ ë° ì •í™•í•œ ìœ„ê²½ë„ ë°ì´í„° ê¸°ë°˜)
    const stationsData = [
        { snm: 'ë‹¤ëŒ€í¬í•´ìˆ˜ìš•ì¥', scd: '95', lat: 35.04803, lng: 128.97151, line: '1í˜¸ì„ ' },
        { snm: 'ë‹¤ëŒ€í¬í•­', scd: '96', lat: 35.05364, lng: 128.97746, line: '1í˜¸ì„ ' },
        { snm: 'ë‚«ê°œ', scd: '97', lat: 35.06456, lng: 128.98586, line: '1í˜¸ì„ ' },
        { snm: 'ì‹ ì¥ë¦¼', scd: '98', lat: 35.07474, lng: 128.99341, line: '1í˜¸ì„ ' },
        { snm: 'ì¥ë¦¼', scd: '99', lat: 35.08378, lng: 129.00163, line: '1í˜¸ì„ ' },
        { snm: 'ë™ë§¤', scd: '100', lat: 35.09459, lng: 129.01186, line: '1í˜¸ì„ ' },
        { snm: 'ì‹ í‰', scd: '101', lat: 35.10656, lng: 129.01975, line: '1í˜¸ì„ ' },
        { snm: 'í•˜ë‹¨', scd: '102', lat: 35.11195, lng: 129.01918, line: '1í˜¸ì„ ' },
        { snm: 'ë‹¹ë¦¬', scd: '103', lat: 35.12051, lng: 129.01633, line: '1í˜¸ì„ ' },
        { snm: 'ì‚¬í•˜', scd: '104', lat: 35.12879, lng: 129.01955, line: '1í˜¸ì„ ' },
        { snm: 'ê´´ì •', scd: '105', lat: 35.13788, lng: 129.02321, line: '1í˜¸ì„ ' },
        { snm: 'ëŒ€í‹°', scd: '106', lat: 35.14371, lng: 129.02396, line: '1í˜¸ì„ ' },
        { snm: 'ì„œëŒ€ì‹ ', scd: '107', lat: 35.14778, lng: 129.02986, line: '1í˜¸ì„ ' },
        { snm: 'ë™ëŒ€ì‹ ', scd: '108', lat: 35.14811, lng: 129.03541, line: '1í˜¸ì„ ' },
        { snm: 'í† ì„±', scd: '109', lat: 35.10515, lng: 129.04351, line: '1í˜¸ì„ ' },
        { snm: 'ìê°ˆì¹˜', scd: '110', lat: 35.14524, lng: 129.02773, line: '1í˜¸ì„ ' },
        { snm: 'ë‚¨í¬', scd: '111', lat: 35.13781, lng: 129.03666, line: '1í˜¸ì„ ' },
        { snm: 'ì¤‘ì•™', scd: '112', lat: 35.10526, lng: 129.04456, line: '1í˜¸ì„ ' },
        { snm: 'ë¶€ì‚°', scd: '113', lat: 35.11479, lng: 129.03964, line: '1í˜¸ì„ ' },
        { snm: 'ì´ˆëŸ‰', scd: '114', lat: 35.12061, lng: 129.04564, line: '1í˜¸ì„ ' },
        { snm: 'ë¶€ì‚°ì§„', scd: '115', lat: 35.13327, lng: 129.05615, line: '1í˜¸ì„ ' },
        { snm: 'ì¢Œì²œ', scd: '116', lat: 35.13725, lng: 129.06451, line: '1í˜¸ì„ ' },
        { snm: 'ë²”ì¼', scd: '117', lat: 35.14515, lng: 129.06646, line: '1í˜¸ì„ ' },
        { snm: 'ë²”ë‚´ê³¨', scd: '118', lat: 35.15781, lng: 129.05929, line: '1í˜¸ì„ ' },
        { snm: 'ì„œë©´(1)', scd: '119', lat: 35.15781, lng: 129.05929, line: '1í˜¸ì„ ' },
        { snm: 'ë¶€ì „', scd: '120', lat: 35.16631, lng: 129.06385, line: '1í˜¸ì„ ' },
        { snm: 'ì–‘ì •', scd: '121', lat: 35.17066, lng: 129.06941, line: '1í˜¸ì„ ' },
        { snm: 'ì‹œì²­', scd: '122', lat: 35.17721, lng: 129.07342, line: '1í˜¸ì„ ' },
        { snm: 'ì—°ì‚°(1)', scd: '123', lat: 35.18844, lng: 129.07849, line: '1í˜¸ì„ ' },
        { snm: 'êµëŒ€', scd: '124', lat: 35.20121, lng: 129.07886, line: '1í˜¸ì„ ' },
        { snm: 'ë™ë˜(1)', scd: '125', lat: 35.20173, lng: 129.08381, line: '1í˜¸ì„ ' },
        { snm: 'ëª…ë¥œ', scd: '126', lat: 35.21043, lng: 129.08272, line: '1í˜¸ì„ ' },
        { snm: 'ì˜¨ì²œì¥', scd: '127', lat: 35.21523, lng: 129.08779, line: '1í˜¸ì„ ' },
        { snm: 'ë¶€ì‚°ëŒ€', scd: '128', lat: 35.22851, lng: 129.08316, line: '1í˜¸ì„ ' },
        { snm: 'ì¥ì „', scd: '129', lat: 35.23439, lng: 129.09117, line: '1í˜¸ì„ ' },
        { snm: 'êµ¬ì„œ', scd: '130', lat: 35.24151, lng: 129.09166, line: '1í˜¸ì„ ' },
        { snm: 'ë‘ì‹¤', scd: '131', lat: 35.25056, lng: 129.09247, line: '1í˜¸ì„ ' },
        { snm: 'ë‚¨ì‚°', scd: '132', lat: 35.25997, lng: 129.09276, line: '1í˜¸ì„ ' },
        { snm: 'ë²”ì–´ì‚¬', scd: '133', lat: 35.27116, lng: 129.09549, line: '1í˜¸ì„ ' },
        { snm: 'ë…¸í¬', scd: '134', lat: 35.28929, lng: 129.09295, line: '1í˜¸ì„ ' },
        { snm: 'ì¥ì‚°', scd: '201', lat: 35.17290, lng: 129.17646, line: '2í˜¸ì„ ' },
        { snm: 'ì¤‘ë™', scd: '202', lat: 35.16879, lng: 129.17046, line: '2í˜¸ì„ ' },
        { snm: 'í•´ìš´ëŒ€', scd: '203', lat: 35.16335, lng: 129.16270, line: '2í˜¸ì„ ' },
        { snm: 'ë™ë°±', scd: '204', lat: 35.15852, lng: 129.15545, line: '2í˜¸ì„ ' },
        { snm: 'ë²¡ìŠ¤ì½”(ì‹œë¦½ë¯¸ìˆ ê´€)', scd: '205', lat: 35.16850, lng: 129.13524, line: '2í˜¸ì„ ' },
        { snm: 'ì„¼í…€ì‹œí‹°', scd: '206', lat: 35.16918, lng: 129.13322, line: '2í˜¸ì„ ' },
        { snm: 'ë¯¼ë½', scd: '207', lat: 35.16110, lng: 129.12459, line: '2í˜¸ì„ ' },
        { snm: 'ìˆ˜ì˜(2)', scd: '208', lat: 35.16738, lng: 129.11760, line: '2í˜¸ì„ ' },
        { snm: 'ê´‘ì•ˆ', scd: '209', lat: 35.15410, lng: 129.11763, line: '2í˜¸ì„ ' },
        { snm: 'ê¸ˆë ¨ì‚°', scd: '210', lat: 35.15174, lng: 129.11051, line: '2í˜¸ì„ ' },
        { snm: 'ë‚¨ì²œ', scd: '211', lat: 35.14728, lng: 129.10375, line: '2í˜¸ì„ ' },
        { snm: 'ê²½ì„±ëŒ€.ë¶€ê²½ëŒ€', scd: '212', lat: 35.14167, lng: 129.10123, line: '2í˜¸ì„ ' },
        { snm: 'ëŒ€ì—°', scd: '213', lat: 35.13812, lng: 129.09542, line: '2í˜¸ì„ ' },
        { snm: 'ëª»ê³¨', scd: '214', lat: 35.13375, lng: 129.09033, line: '2í˜¸ì„ ' },
        { snm: 'ì§€ê²Œê³¨', scd: '215', lat: 35.13061, lng: 129.08310, line: '2í˜¸ì„ ' },
        { snm: 'ë¬¸í˜„', scd: '216', lat: 35.12741, lng: 129.07686, line: '2í˜¸ì„ ' },
        { snm: 'êµ­ì œê¸ˆìœµì„¼í„°Â·ë¶€ì‚°ì€í–‰', scd: '217', lat: 35.14152, lng: 129.06834, line: '2í˜¸ì„ ' },
        { snm: 'ì „í¬', scd: '218', lat: 35.15065, lng: 129.06456, line: '2í˜¸ì„ ' },
        { snm: 'ì„œë©´(2)', scd: '219', lat: 35.15781, lng: 129.05929, line: '2í˜¸ì„ ' },
        { snm: 'ë¶€ì•”', scd: '220', lat: 35.16544, lng: 129.05436, line: '2í˜¸ì„ ' },
        { snm: 'ê°€ì•¼', scd: '221', lat: 35.16973, lng: 129.04753, line: '2í˜¸ì„ ' },
        { snm: 'ë™ì˜ëŒ€', scd: '222', lat: 35.17647, lng: 129.04353, line: '2í˜¸ì„ ' },
        { snm: 'ê°œê¸ˆ', scd: '223', lat: 35.18413, lng: 129.03541, line: '2í˜¸ì„ ' },
        { snm: 'ëƒ‰ì •', scd: '224', lat: 35.18739, lng: 129.02773, line: '2í˜¸ì„ ' },
        { snm: 'ì£¼ë¡€', scd: '225', lat: 35.18374, lng: 129.01955, line: '2í˜¸ì„ ' },
        { snm: 'ê°ì „', scd: '226', lat: 35.17548, lng: 129.00977, line: '2í˜¸ì„ ' },
        { snm: 'ì‚¬ìƒ(2)', scd: '227', lat: 35.15570, lng: 128.98188, line: '2í˜¸ì„ ' },
        { snm: 'ë•í¬', scd: '228', lat: 35.16641, lng: 128.99596, line: '2í˜¸ì„ ' },
        { snm: 'ëª¨ë•', scd: '229', lat: 35.17518, lng: 129.00180, line: '2í˜¸ì„ ' },
        { snm: 'ëª¨ë¼', scd: '230', lat: 35.18567, lng: 128.99557, line: '2í˜¸ì„ ' },
        { snm: 'êµ¬ë‚¨', scd: '231', lat: 35.19515, lng: 129.00147, line: '2í˜¸ì„ ' },
        { snm: 'êµ¬ëª…', scd: '232', lat: 35.20146, lng: 128.99723, line: '2í˜¸ì„ ' },
        { snm: 'ë•ì²œ(2)', scd: '233', lat: 35.21043, lng: 129.00287, line: '2í˜¸ì„ ' },
        { snm: 'ìˆ˜ì •', scd: '234', lat: 35.21631, lng: 129.00213, line: '2í˜¸ì„ ' },
        { snm: 'í™”ëª…', scd: '235', lat: 35.22416, lng: 129.00451, line: '2í˜¸ì„ ' },
        { snm: 'ìœ¨ë¦¬', scd: '236', lat: 35.23253, lng: 129.00676, line: '2í˜¸ì„ ' },
        { snm: 'ë™ì›', scd: '237', lat: 35.24273, lng: 129.01185, line: '2í˜¸ì„ ' },
        { snm: 'ê¸ˆê³¡', scd: '238', lat: 35.25419, lng: 129.01429, line: '2í˜¸ì„ ' },
        { snm: 'í˜¸í¬', scd: '239', lat: 35.26767, lng: 129.01210, line: '2í˜¸ì„ ' },
        { snm: 'ì¦ì‚°', scd: '240', lat: 35.27838, lng: 129.00840, line: '2í˜¸ì„ ' },
        { snm: 'ë¶€ì‚°ëŒ€ì–‘ì‚°ìº í¼ìŠ¤', scd: '241', lat: 35.28659, lng: 129.00552, line: '2í˜¸ì„ ' },
        { snm: 'ë‚¨ì–‘ì‚°', scd: '242', lat: 35.30215, lng: 129.01358, line: '2í˜¸ì„ ' },
        { snm: 'ì–‘ì‚°', scd: '243', lat: 35.30872, lng: 129.02237, line: '2í˜¸ì„ ' },
        { snm: 'ìˆ˜ì˜(3)', scd: '301', lat: 35.16738, lng: 129.11760, line: '3í˜¸ì„ ' },
        { snm: 'ë§ë¯¸', scd: '302', lat: 35.17478, lng: 129.10377, line: '3í˜¸ì„ ' },
        { snm: 'ë°°ì‚°', scd: '303', lat: 35.18456, lng: 129.09653, line: '3í˜¸ì„ ' },
        { snm: 'ë¬¼ë§Œê³¨', scd: '304', lat: 35.19044, lng: 129.08816, line: '3í˜¸ì„ ' },
        { snm: 'ì—°ì‚°(3)', scd: '305', lat: 35.18844, lng: 129.07849, line: '3í˜¸ì„ ' },
        { snm: 'ê±°ì œ', scd: '306', lat: 35.19537, lng: 129.08477, line: '3í˜¸ì„ ' },
        { snm: 'ì¢…í•©ìš´ë™ì¥', scd: '307', lat: 35.19794, lng: 129.06648, line: '3í˜¸ì„ ' },
        { snm: 'ì‚¬ì§', scd: '308', lat: 35.21043, lng: 129.00287, line: '3í˜¸ì„ ' },
        { snm: 'ë¯¸ë‚¨(3)', scd: '309', lat: 35.20739, lng: 128.99598, line: '3í˜¸ì„ ' },
        { snm: 'ë§Œë•', scd: '310', lat: 35.20459, lng: 128.98188, line: '3í˜¸ì„ ' },
        { snm: 'ë‚¨ì‚°ì •', scd: '311', lat: 35.20986, lng: 128.97127, line: '3í˜¸ì„ ' },
        { snm: 'ìˆ™ë“±', scd: '312', lat: 35.21532, lng: 128.96645, line: '3í˜¸ì„ ' },
        { snm: 'ë•ì²œ(3)', scd: '313', lat: 35.19794, lng: 129.06648, line: '3í˜¸ì„ ' },
        { snm: 'êµ¬í¬', scd: '314', lat: 35.20173, lng: 129.08381, line: '3í˜¸ì„ ' },
        { snm: 'ê°•ì„œêµ¬ì²­', scd: '315', lat: 35.20721, lng: 129.09115, line: '3í˜¸ì„ ' },
        { snm: 'ì²´ìœ¡ê³µì›', scd: '316', lat: 35.21516, lng: 129.10178, line: '3í˜¸ì„ ' },
        { snm: 'ëŒ€ì €', scd: '317', lat: 35.22055, lng: 129.10986, line: '3í˜¸ì„ ' },
        { snm: 'ë¯¸ë‚¨(4)', scd: '401', lat: 35.19794, lng: 129.06648, line: '4í˜¸ì„ ' },
        { snm: 'ë™ë˜(4)', scd: '402', lat: 35.20173, lng: 129.08381, line: '4í˜¸ì„ ' },
        { snm: 'ìˆ˜ì•ˆ', scd: '403', lat: 35.20721, lng: 129.09115, line: '4í˜¸ì„ ' },
        { snm: 'ë‚™ë¯¼', scd: '404', lat: 35.21516, lng: 129.10178, line: '4í˜¸ì„ ' },
        { snm: 'ì¶©ë ¬ì‚¬', scd: '405', lat: 35.22055, lng: 129.10986, line: '4í˜¸ì„ ' },
        { snm: 'ëª…ì¥', scd: '406', lat: 35.22550, lng: 129.11746, line: '4í˜¸ì„ ' },
        { snm: 'ì„œë™', scd: '407', lat: 35.23078, lng: 129.12354, line: '4í˜¸ì„ ' },
        { snm: 'ê¸ˆì‚¬', scd: '408', lat: 35.23497, lng: 129.13054, line: '4í˜¸ì„ ' },
        { snm: 'ë°˜ì—¬ë†ì‚°ë¬¼ì‹œì¥', scd: '409', lat: 35.23919, lng: 129.13865, line: '4í˜¸ì„ ' },
        { snm: 'ì„ëŒ€', scd: '410', lat: 35.24430, lng: 129.14659, line: '4í˜¸ì„ ' },
        { snm: 'ì˜ì‚°ëŒ€', scd: '411', lat: 35.24976, lng: 129.15412, line: '4í˜¸ì„ ' },
        { snm: 'ë™ë¶€ì‚°ëŒ€í•™', scd: '412', lat: 35.25345, lng: 129.16226, line: '4í˜¸ì„ ' },
        { snm: 'ê³ ì´Œ', scd: '413', lat: 35.25828, lng: 129.16834, line: '4í˜¸ì„ ' },
        { snm: 'ì•ˆí‰', scd: '414', lat: 35.25828, lng: 129.16834, line: '4í˜¸ì„ ' }
    ];

    const lines = stationsData.reduce((acc, station) => {
        if (!acc[station.line]) {
            acc[station.line] = [];
        }
        acc[station.line].push(station);
        return acc;
    }, {});

    const isTransferStation = (stationName) => {
        const uniqueLines = new Set(stationsData.filter(s => s.snm.startsWith(stationName)).map(s => s.line));
        return uniqueLines.size > 1;
    };

    // 2. Leaflet ì§€ë„ ì´ˆê¸°í™”
    const map = L.map('map').setView([35.1795, 129.0756], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // 3. ì§€ë„ì— ì—­ ë§ˆì»¤ ì¶”ê°€
    const lineColors = {
        '1í˜¸ì„ ': '#E63333',
        '2í˜¸ì„ ': '#00B168',
        '3í˜¸ì„ ': '#FF8F00',
        '4í˜¸ì„ ': '#60469E'
    };
    
    // ì¤‘ë³µ ë§ˆì»¤ ë°©ì§€ë¥¼ ìœ„í•´ ì—­ ì´ë¦„-í˜¸ì„  ì¡°í•©ìœ¼ë¡œ ê³ ìœ  í‚¤ ìƒì„±
    const drawnStations = new Set();
    
    stationsData.forEach(station => {
        const key = `${station.snm}-${station.line}`;
        if (drawnStations.has(key)) return;
        
        let customIcon;
        const markerColor = lineColors[station.line] || '#6c757d';

        if (isTransferStation(station.snm.replace(/\(\d\)/, ''))) {
            customIcon = L.divIcon({
                className: `leaflet-marker-icon transfer-marker-taegeuk`,
                html: ``, 
                iconSize: [20, 20],
                iconAnchor: [10, 10],
                popupAnchor: [0, -10]
            });
        } else {
            customIcon = L.divIcon({
                className: `leaflet-marker-icon line-marker`,
                html: `<div style="background-color: ${markerColor}; width: 100%; height: 100%; border-radius: 50%;"></div>`,
                iconSize: [16, 16],
                iconAnchor: [8, 8],
                popupAnchor: [0, -8]
            });
        }

        const marker = L.marker([station.lat, station.lng], { icon: customIcon }).addTo(map);
        const transferText = isTransferStation(station.snm.replace(/\(\d\)/, '')) ? '<br><b>í™˜ìŠ¹ ê°€ëŠ¥</b> ğŸ”' : '';
        marker.bindPopup(`<b>${station.snm}ì—­</b><br>${station.line}${transferText}`);
        
        drawnStations.add(key);
    });

    // 4. ê²½ë¡œ ê²€ìƒ‰ í¼ êµ¬ì„± ë° ê¸°ëŠ¥ êµ¬í˜„
    const startStationSearch = document.getElementById('startStationSearch');
    const endStationSearch = document.getElementById('endStationSearch');
    const startStationSelect = document.getElementById('startStation');
    const endStationSelect = document.getElementById('endStation');
    const searchBtn = document.getElementById('searchBtn');
    const routeResultDiv = document.getElementById('routeResult');
    const resultContentDiv = document.getElementById('resultContent');

    function updateSelectOptions(inputElement, selectElement) {
        const searchTerm = inputElement.value.toLowerCase();
        
        while (selectElement.firstChild) {
            selectElement.removeChild(selectElement.firstChild);
        }
        
        const filteredStations = stationsData.filter(station =>
            station.snm.toLowerCase().includes(searchTerm)
        );

        // ì¤‘ë³µ ì—­ëª… ë°©ì§€ (ì˜ˆ: ì„œë©´(1), ì„œë©´(2) -> ì„œë©´ìœ¼ë¡œ í†µí•©)
        const uniqueStations = [...new Map(filteredStations.map(item => [item.snm.replace(/\(\d\)/, ''), item])).values()];
        
        uniqueStations.forEach(station => {
            const option = document.createElement('option');
            option.value = station.snm.replace(/\(\d\)/, '');
            option.textContent = `${station.snm.replace(/\(\d\)/, '')} (${station.line})`;
            option.dataset.scode = station.scd;
            selectElement.appendChild(option);
        });
    }

    // ì´ˆê¸° ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ì±„ìš°ê¸°
    updateSelectOptions(startStationSearch, startStationSelect);
    updateSelectOptions(endStationSearch, endStationSelect);

    // ê²€ìƒ‰ì°½ ì…ë ¥ ì´ë²¤íŠ¸
    startStationSearch.addEventListener('input', () => updateSelectOptions(startStationSearch, startStationSelect));
    endStationSearch.addEventListener('input', () => updateSelectOptions(endStationSearch, endStationSelect));


    searchBtn.addEventListener('click', async () => {
        const startStationName = startStationSelect.value;
        const endStationName = endStationSelect.value;

        if (!startStationName || !endStationName) {
            alert('ì¶œë°œì—­ê³¼ ë„ì°©ì—­ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }
        if (startStationName === endStationName) {
            alert('ì¶œë°œì—­ê³¼ ë„ì°©ì—­ì´ ê°™ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }

        const serviceKey = 'YOUR_SERVICE_KEY'; // ì—¬ê¸°ì— ë°œê¸‰ë°›ì€ ì„œë¹„ìŠ¤í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
        const apiUrl = `http://data.humetro.busan.kr/voc/api/open_api_distance.tnn?serviceKey=${serviceKey}&act=json&startSn=${startStationName}&endSn=${endStationName}`;
        
        routeResultDiv.classList.add('d-none');
        resultContentDiv.innerHTML = `<div class="text-center text-muted">ê²½ë¡œë¥¼ ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...</div>`;

        try {
            const response = await fetch(apiUrl);
            if (!response.ok) {
                throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status}`);
            }

            const data = await response.json();
            
            if (data.header.resultCode !== '00') {
                 throw new Error(`API ì‘ë‹µ ì˜¤ë¥˜: ${data.header.resultMsg}`);
            }

            const result = data.body;
            const totalTime = Math.round(result.time / 60);
            const totalDistance = (result.dist / 10).toFixed(1);

            resultContentDiv.innerHTML = `
                <p><strong>ì¶œë°œì—­:</strong> ${startStationName} | <strong>ë„ì°©ì—­:</strong> ${endStationName}</p>
                <p><strong>ì´ ì†Œìš” ì‹œê°„:</strong> ì•½ <span class="text-primary">${totalTime}ë¶„</span></p>
                <p><strong>ì´ ì´ë™ ê±°ë¦¬:</strong> ì•½ <span class="text-primary">${totalDistance}km</span></p>
            `;
            routeResultDiv.classList.remove('d-none');

        } catch (error) {
            console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
            resultContentDiv.innerHTML = `<p class="text-danger">ê²½ë¡œ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>${error.message}</p>`;
            routeResultDiv.classList.remove('d-none');
        }
    });

    // 5. ë…¸ì„ ë³„ ì•„ì½”ë””ì–¸ ëª©ë¡ ë™ì  ìƒì„±
    const accordion = document.getElementById('stationListAccordion');
    
    Object.keys(lines).forEach((lineName, index) => {
        const lineClass = lineName.replace('í˜¸ì„ ', '');
        const lineStations = lines[lineName];
        
        const accordionItem = document.createElement('div');
        accordionItem.classList.add('accordion-item');
        
        const buttonId = `collapse-${index}`;
        const targetId = `collapse${index}`;

        let stationListHtml = '';
        lineStations.forEach(station => {
            const transferIcon = isTransferStation(station.snm.replace(/\(\d\)/, '')) ? ' <i class="bi bi-arrow-right-circle-fill" style="color:#f39c12;"></i>' : '';
            stationListHtml += `<li class="list-group-item">${station.snm} ${transferIcon}</li>`;
        });

        accordionItem.innerHTML = `
            <h2 class="accordion-header" id="heading-${index}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#${targetId}" aria-expanded="false" aria-controls="${targetId}">
                    <span class="line-icon line-${lineClass}-bg">${lineClass}</span>
                    <span style="font-weight: 600;">${lineName}</span>
                </button>
            </h2>
            <div id="${targetId}" class="accordion-collapse collapse" aria-labelledby="heading-${index}" data-bs-parent="#stationListAccordion">
                <div class="accordion-body p-0">
                    <ul class="list-group list-group-flush">
                        ${stationListHtml}
                    </ul>
                </div>
            </div>
        `;
        accordion.appendChild(accordionItem);
    });

    // 6. Chart.js í†µê³„ ì°¨íŠ¸ ìƒì„±
    const stationCounts = {};
    Object.keys(lines).forEach(lineName => {
        stationCounts[lineName] = lines[lineName].length;
    });

    const labels = Object.keys(stationCounts);
    const data = Object.values(stationCounts);

    const ctx = document.getElementById('stationChart').getContext('2d');
    const stationChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'ì´ ì—­ ê°œìˆ˜',
                data: data,
                backgroundColor: [
                    'rgba(231, 76, 60, 0.8)',
                    'rgba(46, 204, 113, 0.8)',
                    'rgba(52, 152, 219, 0.8)',
                    'rgba(155, 89, 182, 0.8)',
                ],
                borderColor: [
                    'rgba(231, 76, 60, 1)',
                    'rgba(46, 204, 113, 1)',
                    'rgba(52, 152, 219, 1)',
                    'rgba(155, 89, 182, 1)',
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'ì—­ ê°œìˆ˜'
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
</script>

</body>
</html>
